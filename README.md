# Sanic Payment API

Это простое асинхронное REST API приложение для управления пользователями, счетами и платежами, реализованное в рамках тестового задания.

Стек:
- **Веб-фреймворк:** Sanic
- **База данных:** PostgreSQL
- **ORM:** SQLAlchemy (асинхронный режим)
- **Миграции:** Alembic
- **Контейнеризация:** Docker, Docker Compose

## Функционал

### Пользователь
- Авторизация по email/password с получением JWT токена.
- Получение информации о себе.
- Получение списка своих счетов и балансов.
- Получение списка своих платежей.

### Администратор
- Все возможности пользователя.
- Создание / Обновление / Удаление пользователей.
- Получение списка всех пользователей с их счетами.

### Платежи
- Реализован эндпоинт для обработки вебхука от платежной системы.
- Вебхук проверяет подпись SHA256, уникальность транзакции и производит зачисление на счет.

## Запуск проекта

### Вариант 1: С использованием Docker Compose (рекомендуемый)

Этот способ автоматически поднимет и настроит приложение и базу данных.

1.  **Клонируйте репозиторий:**
    ```bash
    git clone https://github.com/kislyakov84/sanic_payment_api
    cd sanic_payment_api
    ```

2.  **Создайте `.env` файл:**
    Скопируйте `example.env` в `.env`:
    ```bash
    cp example.env .env
    ```
    *Вы можете изменить значения в `.env` файле, если это необходимо.*

3.  **Запустите Docker Compose:**
    ```bash
    docker compose up --build
    ```
    Флаг `--build` заставит Docker пересобрать образ вашего приложения, если были внесены изменения.

Приложение будет доступно по адресу `http://127.0.0.1:8000`.

### Вариант 2: Локальный запуск (без Docker)

1.  **Установите и запустите PostgreSQL** удобным для вас способом.

2.  **Установите Python 3.12** (рекомендуется использовать `pyenv`).

3.  **Клонируйте репозиторий и перейдите в него.**

4.  **Создайте и активируйте виртуальное окружение:**
    ```bash
    uv venv
    source .venv/bin/activate
    ```

5.  **Установите зависимости:**
    ```bash
    uv pip install -r requirements.txt
    ```

6.  **Создайте `.env` файл:**
    Скопируйте `example.env` в `.env` и убедитесь, что настройки подключения к вашей локальной базе данных верны.
    ```bash
    cp example.env .env
    ```

7.  **Примените миграции к базе данных:**
    ```bash
    alembic upgrade head
    ```

8.  **Запустите приложение:**
    ```bash
    python -m src.main
    ```

## Данные для входа

При первом запуске (через миграции) создаются два тестовых пользователя:

-   **Обычный пользователь:**
    -   **Email:** `testuser@example.com`
    -   **Password:** `password`

-   **Администратор:**
    -   **Email:** `admin@example.com`
    -   **Password:** `admin_password`